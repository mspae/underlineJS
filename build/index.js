!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.underlinejs=t()}}(function(){var t;return function e(t,i,n){function s(l,r){if(!i[l]){if(!t[l]){var h="function"==typeof require&&require;if(!r&&h)return h(l,!0);if(o)return o(l,!0);var a=new Error("Cannot find module '"+l+"'");throw a.code="MODULE_NOT_FOUND",a}var d=i[l]={exports:{}};t[l][0].call(d.exports,function(e){var i=t[l][1][e];return s(i?i:e)},d,d.exports,e,t,i,n)}return i[l].exports}for(var o="function"==typeof require&&require,l=0;l<n.length;l++)s(n[l]);return s}({1:[function(e,i,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(e,o){"function"==typeof t&&t.amd?t("baselineRatio",[],function(){return e.baselineRatio=o()}):"object"===("undefined"==typeof n?"undefined":s(n))?i.exports=o():e.baselineRatio=o()}(void 0,function(){var t=function(t){t=t||document.body;var e=document.createElement("div");e.style.display="block",e.style.position="absolute",e.style.bottom="0",e.style.right="0",e.style.width="0px",e.style.height="0px",e.style.margin="0",e.style.padding="0",e.style.visibility="hidden",e.style.overflow="hidden";var i=document.createElement("span"),n=document.createElement("span");i.style.fontSize="0px",n.style.fontSize="2000px",i.innerHTML="X",n.innerHTML="X",e.appendChild(i),e.appendChild(n),t.appendChild(e);var s=i.getBoundingClientRect(),o=n.getBoundingClientRect();t.removeChild(e);var l=s.top-o.top,r=o.height;return 1-l/r};return t})},{}],2:[function(e,i,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(e,o){"function"==typeof t&&t.amd?t("underline",[],function(){return e.underline=o()}):"object"===("undefined"==typeof n?"undefined":s(n))?i.exports=o():e.underline=o()}(void 0,function(){function t(t){var e=t,i=n(t),s=parseFloat(window.getComputedStyle(e,null).getPropertyValue("line-height")),o=window.getComputedStyle(e,null).getPropertyValue("font-family"),l=window.getComputedStyle(e,null).getPropertyValue("font-size"),r=window.getComputedStyle(e,null).getPropertyValue("font-style"),h=e.getBoundingClientRect().width,a=e.getBoundingClientRect().height,d=e.parentNode.getBoundingClientRect().width,u=e.offsetLeft,c=e.parentNode.offsetLeft,f=c-u,y=u-c;return{lineHeight:s,width:h,height:a,parentWidth:d,fontFamily:o,fontSize:l,fontStyle:r,baselinePositionRatio:i,canvasLeft:f,textIndent:y}}function i(e,i){this.underlines=[],e||console.error("No element defined!");var n={"text-underline-color":i.color||"#000","text-underline-position":i.position||"auto","text-underline-skip":i.skip||!0,"text-underline-width":i.width||"auto"};e="string"==typeof e?document.querySelectorAll(e):e,[].forEach.call(e,function(i){var l,r=t(e);l=r.height>r.lineHeight?new s(e,n,r):new o(e,n,r),this.underlines.push(l)}.bind(this))}var n=e("./baseline-ratio"),s=e("./multiple-underline"),o=e("./single-underline"),l=function(t){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();return i.prototype.animate=function(){this.underlines.forEach(function(t){t.clear(),t.update(),t.draw()}.bind(this)),l(this.animate)},i})},{"./baseline-ratio":1,"./multiple-underline":3,"./single-underline":4}],3:[function(e,i,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(e,o){"function"==typeof t&&t.amd?t("multipleUnderline",[],function(){return e.multipleUnderline=o()}):"object"===("undefined"==typeof n?"undefined":s(n))?i.exports=o():e.MultipleUnderline=o()}(void 0,function(){function t(t,e,i){this.element=t,this.text=this.element.textContent,this.underlineStyles=e,this.elementStyles=i,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ratio=window.devicePixelRatio,this.canvas.width=this.elementStyles.width*this.ratio,this.canvas.height=this.elementStyles.height*this.ratio,this.canvas.style.left=this.elementStyles.canvasLeft+"px",this.element.appendChild(this.canvas),this.canvas.style.width=this.elementStyles.width+"px",this.ctx.font=this.font=this.elementStyles.fontStyle+" "+multiplyValue(this.elementStyles.fontSize,this.ratio)+" "+this.elementStyles.fontFamily,this.multipleRedrawActive=!1,is_chrome?this.elementStyles.lineHeight=this.elementStyles.lineHeight*this.ratio:this.elementStyles.lineHeight=this.elementStyles.lineHeight*this.ratio;var n=this.ctx.measureText(".").width;if("auto"==this.underlineStyles["text-underline-width"]?this.strokeWidth=n/12:(this.strokeWidth=this.underlineStyles["text-underline-width"],this.strokeWidth=parseFloat(this.strokeWidth)*this.ratio),"auto"==this.underlineStyles["text-underline-position"])this.underlinePosition=parseFloat(this.elementStyles.fontSize)*this.ratio*(1-this.elementStyles.baselinePositionRatio+.4*this.elementStyles.baselinePositionRatio)+this.strokeWidth/2;else{var s=parseFloat(this.underlineStyles["text-underline-position"]);this.underlinePosition=parseFloat(this.elementStyles.fontSize)*this.ratio*(1-this.elementStyles.baselinePositionRatio+this.elementStyles.baselinePositionRatio*s)+this.strokeWidth/2}var o=optimalStrokeWidthPos(this.strokeWidth,this.underlinePosition);this.strokeWidth=o.strokeWidth,this.underlinePosition=o.posY,this.lines=[],this.myStrings=[];for(var l=this.text.match(/[^\s-]+-?\s?/g),r="",h=0,a=0,d=0;d<l.length;d++){if(l[d].match(/\s+$/)){var u=l[d].replace(/\s+$/,""),c=r+u,f=this.ctx.measureText(c),y=f.width;c+=" "}else var c=r+l[d],f=this.ctx.measureText(c),y=f.width;if(a)if(y>this.elementStyles.parentWidth*this.ratio&&d>0){if(r.match(/\s+$/))var p=this.ctx.measureText(r.replace(/\s+$/,"")),m=p.width;else var p=this.ctx.measureText(r),m=p.width;var x={lineText:r,lineTextIndent:-.2,linePositionY:h,lineMeasureWidth:m};this.lines.push(x),r=l[d],h+=this.elementStyles.lineHeight}else r=c;else if(y+this.elementStyles.textIndent*this.ratio>this.elementStyles.parentWidth*this.ratio&&d>0){if(r.match(/\s+$/))var p=this.ctx.measureText(r.replace(/\s+$/,"")),m=p.width;else var p=this.ctx.measureText(r),m=p.width;var x={lineText:r,lineTextIndent:this.elementStyles.textIndent*this.ratio-.2,linePositionY:h,lineMeasureWidth:m};this.lines.push(x),r=l[d],h+=this.elementStyles.lineHeight,a++}else r=c}if(r.match(/\s+$/))var p=this.ctx.measureText(r.replace(/\s+$/,"")),m=p.width;else var p=this.ctx.measureText(r),m=p.width;var x={lineText:r,lineTextIndent:-.2,linePositionY:h,lineMeasureWidth:m};this.lines.push(x);for(var w=0;w<this.lines.length;w++){var x=this.lines[w],S=new GuitarString(this.ctx,new Point(x.lineTextIndent,x.linePositionY+this.underlinePosition),new Point(x.lineTextIndent+x.lineMeasureWidth,x.linePositionY+this.underlinePosition),this.strokeWidth,this.underlineStyles["text-underline-color"],this.ratio);this.myStrings.push(S)}this.drawUnderline(),this.drawHoles()}return t.prototype.drawUnderline=function(){for(var t=0;t<this.myStrings.length;t++){var e=this.myStrings[t];e.update(),e.draw()}},t.prototype.drawHoles=function(){for(var t=0;t<this.lines.length;t++){var e=this.lines[t];this.ctx.globalCompositeOperation="destination-out",this.ctx.font=this.font,this.ctx.fillStyle="green",this.ctx.textBaseline="top",this.ctx.fillText(e.lineText,e.lineTextIndent,e.linePositionY),this.ctx.lineWidth=2*this.ratio+3.6*this.strokeWidth,this.ctx.strokeStyle="blue",this.ctx.strokeText(e.lineText,e.lineTextIndent,e.linePositionY)}},t.prototype.clear=function(){this.multipleRedrawActive;this.multipleRedrawActive=!1;for(var t=0;t<this.myStrings.length;t++){var e=this.myStrings[t];e.redrawActive&&(this.multipleRedrawActive=!0)}this.multipleRedrawActive&&(console.log("clear now!"),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))},t.prototype.update=function(){},t.prototype.draw=function(){this.multipleRedrawActive&&(this.drawUnderline(),this.drawHoles())},t})},{}],4:[function(e,i,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(e,o){"function"==typeof t&&t.amd?t("singleUnderline",[],function(){return e.singleUnderline=o()}):"object"===("undefined"==typeof n?"undefined":s(n))?i.exports=o():e.SingleUnderline=o()}(void 0,function(){function t(t,n,s){this.element=t,this.text=this.element.textContent,this.underlineStyles=n,this.elementStyles=s,this.redrawActive=!1,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ratio=window.devicePixelRatio,this.canvas.width=this.elementStyles.width*this.ratio,this.canvas.height=this.elementStyles.height*this.ratio,this.element.appendChild(this.canvas),this.canvas.style.width=this.elementStyles.width+"px",this.ctx.font=this.font=this.elementStyles.fontStyle+" "+e(this.elementStyles.fontSize,this.ratio)+" "+this.elementStyles.fontFamily;var o=this.ctx.measureText(".").width;if("auto"==this.underlineStyles["text-underline-width"]?this.strokeWidth=o/12:(this.strokeWidth=this.underlineStyles["text-underline-width"],this.strokeWidth=parseFloat(this.strokeWidth)*this.ratio),"auto"==this.underlineStyles["text-underline-position"])this.underlinePosition=parseFloat(this.elementStyles.height)*this.ratio*(1-this.elementStyles.baselinePositionRatio+.4*this.elementStyles.baselinePositionRatio)+this.strokeWidth/2;else{var l=parseFloat(this.underlineStyles["text-underline-position"]);this.underlinePosition=parseFloat(this.elementStyles.height)*this.ratio*(1-this.elementStyles.baselinePositionRatio+this.elementStyles.baselinePositionRatio*l)+this.strokeWidth/2}var r=i(this.strokeWidth,this.underlinePosition);this.strokeWidth=r.strokeWidth,this.underlinePosition=r.posY,textWidth=this.ctx.measureText(this.text).width,this.myString=new GuitarString(this.ctx,new Point(0,this.underlinePosition),new Point(textWidth,this.underlinePosition),this.strokeWidth,this.underlineStyles["text-underline-color"],this.ratio),this.drawHoles()}var e=function(t,e){var i=t,n=e,s=i.match(/(\d*\.?\d*)(.*)/);return s[1]*n+s[2]},i=function(t,e){return 1>t?e=Math.round(e-.5)+.5:t>=1&&(t=Math.round(t),e=t%2?Math.round(e-.5)+.5:Math.round(e)),{strokeWidth:t,posY:e}};return t.prototype.drawUnderline=function(){this.myString.draw()},t.prototype.drawHoles=function(){this.ctx.font=this.font,this.ctx.textBaseline="top",this.ctx.globalCompositeOperation="destination-out",this.ctx.lineWidth=2*this.ratio+3.6*this.strokeWidth,this.ctx.strokeStyle="blue",this.ctx.beginPath(),this.ctx.strokeText(this.text,-.2,0),this.ctx.fillStyle="green",this.ctx.beginPath(),this.ctx.fillText(this.text,-.2,0)},t.prototype.clear=function(){this.redrawActive=this.myString.redrawActive,this.myString.redrawActive&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.update=function(){this.myString.redrawActive&&this.myString.update()},t.prototype.draw=function(){this.redrawActive&&(this.drawUnderline(),this.drawHoles())},t})},{}]},{},[2])(2)});
//# sourceMappingURL=index.js.map
