{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","index.js","js/baseline-ratio.js","js/guitar-string.js","js/index.js","js/multiple-underline.js","js/multiply-value.js","js/optimal-stroke-width-pos.js","js/point.js","js/single-underline.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","Underline","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"_typeof","Symbol","iterator","obj","constructor","root","factory","baselineRatio","undefined","elem","document","body","container","createElement","style","display","position","bottom","right","width","height","margin","padding","visibility","overflow","small","large","fontSize","innerHTML","appendChild","smalldims","getBoundingClientRect","largedims","removeChild","baselineposition","top",2,"guitarString","GuitarString","play_multi_sound","audiochannels","thistime","Date","getTime","getElementById","duration","src","load","play","ctx","startPoint","endPoint","strokeWidth","strokeColor","ratio","canvas","level","musicLevel","maxGrabDistance","maxControlDistance","lineWidth","strokeStyle","beginPath","moveTo","x","y","lineTo","globalCompositeOperation","stroke","currentMouseX","currentMouseY","lastMouseX","lastMouseY","waveInitX","waveInitY","waveCount","damping","thirdPoint","Point","userInControl","userPlucked","waveInControl","waveFinished","initState","lastRedraw","redrawActive","addEventListener","event","mouseOver","mouseMove","mouseLeave","mouseOut","touchDown","touchXY","touchUp","channel_max","navigator","userAgent","toLowerCase","indexOf","Array","Audio","circleCenter","dy1","dx1","dy2","dx2","aSlope","bSlope","centerX","centerY","dist","x0","y0","Math","sqrt","intersects","b","c","d","p","q","det","gamma","lambda","floor","prototype","layerX","layerY","radius","currentWaveDistance","pow","abs","lastRadius","lastWaveDistance","mouseInGrabRange","lastMouseOutGrabRange","mouseOutControlRange","lastMouseInControlRange","mouseCrossed","clear","update","waveX","waveY","cos","PI","draw","drawLine","drawArc","centerObject","angle","atan2","arc","./point",3,"underline","getElementStyles","element","$this","baselinePositionRatio","lineHeight","parseFloat","getComputedStyle","getPropertyValue","fontFamily","fontStyle","parentWidth","parentNode","offsetLeft","parentOffsetLeft","canvasLeft","textIndent","options","underlines","console","error","underlineStyles","text-underline-color","color","text-underline-position","text-underline-skip","skip","text-underline-width","querySelectorAll","forEach","el","elementStyles","MultipleUnderline","SingleUnderline","push","bind","animate","requestAnimFrame","callback","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","./baseline-ratio","./multiple-underline","./single-underline",4,"multipleUnderline","text","textContent","getContext","devicePixelRatio","left","font","multiplyValue","multipleRedrawActive","is_chrome","dotWidth","measureText","underlinePosition","userUnderlinePosition","adjustValue","optimalStrokeWidthPos","posY","lines","myStrings","words","match","line","linePositionY","firstLineCount","newWord","replace","testLine","testLineMetrics","testLineWidth","lineMetrics","tempLine","lineText","lineTextIndent","lineMeasureWidth","myString","drawUnderline","drawHoles","tempString","fillStyle","textBaseline","fillText","strokeText","log","clearRect","./guitar-string","./multiply-value","./optimal-stroke-width-pos",5,"MultiplyValue","value","multiplier","str","m","result",6,"OptimalStrokeWidthPos","round",7,"point",8,"singleUnderline","textWidth"],"mappings":"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","file":"index.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.Underline = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('baselineRatio', [], function () {\n      return root.baselineRatio = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.baselineRatio = factory();\n  }\n})(undefined, function () {\n  var baselineRatio = function baselineRatio(elem) {\n    // Get the baseline in the context of whatever element is passed in.\n    elem = elem || document.body;\n\n    // The container is a little defenseive.\n    var container = document.createElement('div');\n    container.style.display = \"block\";\n    container.style.position = \"absolute\";\n    container.style.bottom = \"0\";\n    container.style.right = \"0\";\n    container.style.width = \"0px\";\n    container.style.height = \"0px\";\n    container.style.margin = \"0\";\n    container.style.padding = \"0\";\n    container.style.visibility = \"hidden\";\n    container.style.overflow = \"hidden\";\n\n    // Intentionally unprotected style definition.\n    var small = document.createElement('span');\n    var large = document.createElement('span');\n\n    // Large numbers help improve accuracy.\n    small.style.fontSize = \"0px\";\n    large.style.fontSize = \"2000px\";\n\n    small.innerHTML = \"X\";\n    large.innerHTML = \"X\";\n\n    container.appendChild(small);\n    container.appendChild(large);\n\n    // Put the element in the DOM for a split second.\n    elem.appendChild(container);\n    var smalldims = small.getBoundingClientRect();\n    var largedims = large.getBoundingClientRect();\n    elem.removeChild(container);\n\n    // Calculate where the baseline was, percentage-wise.\n    var baselineposition = smalldims.top - largedims.top;\n    var height = largedims.height;\n\n    return 1 - baselineposition / height;\n  };\n\n  return baselineRatio;\n});\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('guitarString', [], function () {\n      return root.guitarString = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.GuitarString = factory();\n  }\n})(undefined, function () {\n  var Point = require('./point');\n  var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n\n  //audio play multiple channels at the same time: http://www.storiesinflight.com/html5/audio.html\n  var channel_max = 10; // number of channels\n  var audiochannels = new Array();\n  for (var a = 0; a < channel_max; a++) {\n    // prepare the channels\n    audiochannels[a] = new Array();\n    audiochannels[a]['channel'] = new Audio(); // create a new audio object\n    audiochannels[a]['finished'] = -1; // expected end time for this channel\n  }\n\n  function play_multi_sound(s) {\n    for (var a = 0; a < audiochannels.length; a++) {\n      var thistime = new Date();\n      if (audiochannels[a]['finished'] < thistime.getTime()) {\n        // is this channel finished?\n        audiochannels[a]['finished'] = thistime.getTime() + document.getElementById(s).duration * 1000;\n        audiochannels[a]['channel'].src = document.getElementById(s).src;\n        audiochannels[a]['channel'].load();\n        audiochannels[a]['channel'].play();\n        break;\n      }\n    }\n  }\n\n  var circleCenter = function circleCenter(startPoint, thirdPoint, endPoint) {\n    var dy1 = thirdPoint.y - startPoint.y;\n    var dx1 = thirdPoint.x - startPoint.x;\n    var dy2 = endPoint.y - thirdPoint.y;\n    var dx2 = endPoint.x - thirdPoint.x;\n\n    var aSlope = dy1 / dx1;\n    var bSlope = dy2 / dx2;\n\n    var centerX = (aSlope * bSlope * (startPoint.y - endPoint.y) + bSlope * (startPoint.x + thirdPoint.x) - aSlope * (thirdPoint.x + endPoint.x)) / (2 * (bSlope - aSlope));\n    var centerY = -1 * (centerX - (startPoint.x + thirdPoint.x) / 2) / aSlope + (startPoint.y + thirdPoint.y) / 2;\n    var r = dist(centerX, centerY, startPoint.x, startPoint.y);\n\n    return {\n      x: centerX,\n      y: centerY,\n      r: r\n    };\n  };\n\n  var dist = function dist(x, y, x0, y0) {\n    return Math.sqrt((x -= x0) * x + (y -= y0) * y);\n  };\n\n  var intersects = function intersects(a, b, c, d, p, q, r, s) {\n    // returns true if the line from (a,b)->(c,d) intersects with (p,q)->(r,s)\n    var det, gamma, lambda;\n    det = (c - a) * (s - q) - (r - p) * (d - b);\n    if (det === 0) {\n      return false;\n    } else {\n      lambda = ((s - q) * (r - a) + (p - r) * (s - b)) / det;\n      gamma = ((b - d) * (r - a) + (c - a) * (s - b)) / det;\n      return 0 < lambda && lambda < 1 && 0 < gamma && gamma < 1;\n    }\n  };\n\n  var musicLevel = function musicLevel(startPoint, endPoint, ratio) {\n    var length = dist(startPoint.x, startPoint.y, endPoint.x, endPoint.y) / ratio;\n\n    var level = Math.floor(length / 30);\n    if (level > 19) {\n      level = 19;\n    }\n    level = 19 - level;\n    if (level < 10) {\n      level = '0' + level;\n    }\n    return level;\n  };\n\n  function GuitarString(ctx, startPoint, endPoint, strokeWidth, strokeColor, ratio) {\n    //ctor\n    this.ctx = ctx;\n    this.canvas = ctx.canvas;\n    this.startPoint = startPoint;\n    this.endPoint = endPoint;\n    this.strokeWidth = strokeWidth;\n    this.strokeColor = strokeColor;\n    this.ratio = ratio;\n\n    this.level = musicLevel(this.startPoint, this.endPoint, this.ratio);\n\n    // this.canvas.width = this.canvas.clientWidth;\n    // this.canvas.height = this.canvas.clientHeight*1.2;\n\n    this.maxGrabDistance = this.strokeWidth * 2;\n    this.maxControlDistance = this.strokeWidth * 6;\n\n    this.ctx.lineWidth = this.strokeWidth;\n    this.ctx.strokeStyle = this.strokeColor;\n    this.ctx.beginPath();\n    this.ctx.moveTo(this.startPoint.x, this.startPoint.y);\n    this.ctx.lineTo(this.endPoint.x, this.endPoint.y);\n    this.ctx.globalCompositeOperation = \"source-over\";\n    this.ctx.stroke();\n\n    this.currentMouseX;\n    this.currentMouseY;\n    this.lastMouseX;\n    this.lastMouseY;\n    this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n    this.waveInitY = this.startPoint.y - this.maxControlDistance;\n    this.waveCount = 0;\n    this.damping = 0.9;\n\n    this.thirdPoint = new Point((this.startPoint.x + this.endPoint.x) / 2, this.startPoint.y);\n\n    // state flags\n    this.userInControl = false;\n    this.userPlucked = false;\n    this.waveInControl = false;\n    this.waveFinished = false;\n    this.initState = true;\n    this.lastRedraw = false;\n    this.redrawActive = false;\n\n    //add event listener\n    var self = this;\n    this.canvas.addEventListener('mouseover', function (event) {\n      self.mouseOver(self, event);\n    }, false);\n\n    this.canvas.addEventListener('mousemove', function (event) {\n      self.mouseMove(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"mouseleave\", function (event) {\n      self.mouseLeave(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"mouseout\", function (event) {\n      self.mouseOut(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"touchstart\", function (event) {\n      self.touchDown(self, event);\n    }, false);\n    this.canvas.addEventListener(\"touchmove\", function (event) {\n      self.touchXY(self, event);\n    }, false);\n    this.canvas.addEventListener(\"touchend\", function (event) {\n      self.touchUp(self, event);\n    }, false);\n  }\n\n  GuitarString.prototype.mouseOver = function (self, event) {\n    // console.log('mouseOver');\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseX = event.layerY * this.ratio;\n  };\n  GuitarString.prototype.mouseMove = function (self, event) {\n    // console.log('mouseMove');\n    this.lastMouseX = this.currentMouseX;\n    this.lastMouseY = this.currentMouseY;\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseY = event.layerY * this.ratio;\n\n    var radius = circleCenter(new Point(this.startPoint.x, this.startPoint.y), new Point(this.currentMouseX, this.currentMouseY), new Point(this.endPoint.x, this.endPoint.y)).r;\n    var currentWaveDistance = radius - Math.sqrt(Math.pow(radius, 2) - Math.pow(Math.abs(this.endPoint.x - this.startPoint.x) / 2, 2));\n    var lastRadius = circleCenter(new Point(this.startPoint.x, this.startPoint.y), new Point(this.lastMouseX, this.lastMouseY), new Point(this.endPoint.x, this.endPoint.y)).r;\n    var lastWaveDistance = lastRadius - Math.sqrt(Math.pow(lastRadius, 2) - Math.pow(Math.abs(this.endPoint.x - this.startPoint.x) / 2, 2));\n\n    var mouseInGrabRange = currentWaveDistance < this.maxGrabDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x;\n\n    var lastMouseOutGrabRange = !(lastWaveDistance < this.maxGrabDistance && this.lastMouseX > this.startPoint.x && this.lastMouseX < this.endPoint.x);\n\n    var mouseOutControlRange = !(currentWaveDistance < this.maxControlDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x);\n\n    var lastMouseInControlRange = lastWaveDistance < this.maxControlDistance && this.lastMouseX > this.startPoint.x && this.lastMouseY < this.endPoint.x;\n\n    var mouseCrossed = intersects(this.lastMouseX, this.lastMouseY, this.currentMouseX, this.currentMouseY, this.startPoint.x, this.startPoint.y, this.endPoint.x, this.endPoint.y);\n\n    if (mouseInGrabRange && lastMouseOutGrabRange && !this.userInControl) {\n      // console.log('grab!');\n      this.initState = false;\n      this.userInControl = true;\n      this.waveInControl = false;\n      this.waveFinished = false;\n\n      this.redrawActive = true;\n    } else if (mouseOutControlRange && lastMouseInControlRange && this.userInControl) {\n      // console.log('boing!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.waveCount = 0;\n      // this.waveInitX = this.lastMouseX;\n      // this.waveInitY = this.lastMouseY;\n      this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n      this.waveInitY = this.endPoint.y + this.maxControlDistance;\n      // play audio\n      play_multi_sound('audio' + this.level);\n      // createjs.Sound.play('cello_' + this.level);\n    }\n\n    if (!this.userInControl && mouseCrossed) {\n      // console.log('i just plucked!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n      this.waveInitX = (this.startPoint.x + this.endPoint.y) / 2;\n      this.waveInitY = this.endPoint.y + this.maxGrabDistance * 2 / 3;\n    }\n  };\n  GuitarString.prototype.mouseLeave = function (self, event) {\n    // console.log('mouseLeave');\n    if (this.userInControl) {\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n\n      this.waveInitX = event.layerX * this.ratio;\n      this.waveInitY = event.layerY * this.ratio;\n    }\n  };\n  GuitarString.prototype.mouseOut = function (self, event) {\n    // console.log('mouseOut');\n  };\n  GuitarString.prototype.touchDown = function (self, event) {\n    // console.log('touchDown');\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseX = event.layerY * this.ratio;\n  };\n  GuitarString.prototype.touchXY = function (self, event) {\n    // console.log('touchMove');\n    this.lastMouseX = this.currentMouseX;\n    this.lastMouseY = this.currentMouseY;\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseY = event.layerY * this.ratio;\n\n    var radius = circleCenter(new Point(this.startPoint.x, this.startPoint.y), new Point(this.currentMouseX, this.currentMouseY), new Point(this.endPoint.x, this.endPoint.y)).r;\n    var currentWaveDistance = radius - Math.sqrt(Math.pow(radius, 2) - Math.pow(Math.abs(this.endPoint.x - this.startPoint.x) / 2, 2));\n    var lastRadius = circleCenter(new Point(this.startPoint.x, this.startPoint.y), new Point(this.lastMouseX, this.lastMouseY), new Point(this.endPoint.x, this.endPoint.y)).r;\n    var lastWaveDistance = lastRadius - Math.sqrt(Math.pow(lastRadius, 2) - Math.pow(Math.abs(this.endPoint.x - this.startPoint.x) / 2, 2));\n\n    var mouseInGrabRange = currentWaveDistance < this.maxGrabDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x;\n\n    var lastMouseOutGrabRange = !(lastWaveDistance < this.maxGrabDistance && this.lastMouseX > this.startPoint.x && this.lastMouseX < this.endPoint.x);\n\n    var mouseOutControlRange = !(currentWaveDistance < this.maxControlDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x);\n\n    var lastMouseInControlRange = lastWaveDistance < this.maxControlDistance && this.lastMouseX > this.startPoint.x && this.lastMouseY < this.endPoint.x;\n\n    var mouseCrossed = intersects(this.lastMouseX, this.lastMouseY, this.currentMouseX, this.currentMouseY, this.startPoint.x, this.startPoint.y, this.endPoint.x, this.endPoint.y);\n\n    if (mouseInGrabRange && lastMouseOutGrabRange && !this.userInControl) {\n      // console.log('grab!');\n      this.initState = false;\n      this.userInControl = true;\n      this.waveInControl = false;\n      this.waveFinished = false;\n\n      this.redrawActive = true;\n    } else if (mouseOutControlRange && lastMouseInControlRange && this.userInControl) {\n      // console.log('boing!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.waveCount = 0;\n      // this.waveInitX = this.lastMouseX;\n      // this.waveInitY = this.lastMouseY;\n      this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n      this.waveInitY = this.endPoint.y + this.maxControlDistance;\n      // play audio\n      play_multi_sound('audio' + this.level);\n    }\n\n    if (!this.userInControl && mouseCrossed) {\n      // console.log('i just plucked!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n      this.waveInitX = (this.startPoint.x + this.endPoint.y) / 2;\n      this.waveInitY = this.endPoint.y + this.maxGrabDistance * 2 / 3;\n      // play audio\n      // play_multi_sound('audio' + this.level);\n    }\n  };\n  GuitarString.prototype.touchUp = function (self, event) {\n    // console.log('touchUp');\n    if (this.userInControl) {\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n\n      this.waveInitX = event.layerX * this.ratio;\n      this.waveInitY = event.layerY * this.ratio;\n    }\n  };\n\n  GuitarString.prototype.clear = function () {\n    // clear\n    // if(this.redrawActive){\n    // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    // }\n  };\n\n  GuitarString.prototype.update = function () {\n    // console.log(this.redrawActive);\n    // if(this.redrawActive){\n    if (this.userInControl) {\n      this.thirdPoint = new Point(this.currentMouseX, this.currentMouseY);\n    }\n    if (this.waveInControl) {\n      var waveX = this.waveInitX;\n      var waveY = this.startPoint.y + (this.waveInitY - this.startPoint.y) * Math.cos(this.waveCount / 5 * Math.PI) * Math.pow(this.damping, this.waveCount);\n\n      if (Math.pow(this.damping, this.waveCount) > 0.03) {\n        // still waving ....\n        this.thirdPoint = new Point(waveX, waveY);\n        this.waveCount++;\n      } else {\n        // wave damped to a straight line, wave is finished\n        this.waveInControl = false;\n        this.waveFinished = true;\n        this.lastRedraw = true;\n        this.thirdPoint = new Point(waveX, waveY);\n      }\n    }\n    // }\n  };\n\n  GuitarString.prototype.draw = function () {\n    // if(this.redrawActive){\n    // draw stuff\n    // }\n    if (this.lastRedraw) {\n      this.drawLine();\n      this.lastRedraw = false;\n      this.redrawActive = false;\n    } else {\n      this.drawArc(this.startPoint, this.thirdPoint, this.endPoint);\n    }\n  };\n  GuitarString.prototype.drawLine = function () {\n    // draw a line instead of a flat curve when it stops redraw, pixel-perfect\n    this.ctx.lineWidth = this.strokeWidth;\n    this.ctx.strokeStyle = this.strokeColor;\n    this.ctx.beginPath();\n    this.ctx.moveTo(this.startPoint.x, this.startPoint.y);\n    this.ctx.lineTo(this.endPoint.x, this.endPoint.y);\n    this.ctx.globalCompositeOperation = \"source-over\";\n    this.ctx.stroke();\n  };\n\n  GuitarString.prototype.drawArc = function (startPoint, thirdPoint, endPoint) {\n    var ctx = this.ctx;\n    ctx.lineWidth = this.strokeWidth;\n    ctx.strokeStyle = this.strokeColor;\n\n    var centerObject = circleCenter(new Point(startPoint.x, startPoint.y), new Point(thirdPoint.x, thirdPoint.y), new Point(endPoint.x, endPoint.y));\n    var centerX = centerObject.x;\n    var centerY = centerObject.y;\n    var r = centerObject.r;\n\n    var angle = Math.atan2(centerX - startPoint.x, centerY - startPoint.y);\n    // console.log(centerObject);\n    if (!angle) {\n      ctx.beginPath();\n      ctx.moveTo(startPoint.x, startPoint.y);\n      ctx.lineTo(endPoint.x, endPoint.y);\n    } else {\n      if (angle > Math.PI / 2) {\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, r, Math.PI * 1.5 - angle, Math.PI * 1.5 + angle, true);\n      } else {\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, r, Math.PI * 1.5 - angle, Math.PI * 1.5 + angle, false);\n      }\n    }\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.stroke();\n  };\n  return GuitarString;\n});\n\n},{\"./point\":7}],3:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('underline', [], function () {\n      return root.underline = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Underline = factory();\n  }\n})(undefined, function () {\n  var baselineRatio = require('./baseline-ratio');\n  var MultipleUnderline = require('./multiple-underline');\n  var SingleUnderline = require('./single-underline');\n\n  function getElementStyles(element) {\n    // lineHeight, height, ratio, fontFamily, fontSize, fontStyle\n    var $this = element;\n\n    var baselinePositionRatio = baselineRatio(element);\n    var lineHeight = parseFloat(window.getComputedStyle($this, null).getPropertyValue(\"line-height\"));\n    var fontFamily = window.getComputedStyle($this, null).getPropertyValue(\"font-family\");\n    var fontSize = window.getComputedStyle($this, null).getPropertyValue(\"font-size\");\n    var fontStyle = window.getComputedStyle($this, null).getPropertyValue(\"font-style\");\n    var width = $this.getBoundingClientRect().width;\n    var height = $this.getBoundingClientRect().height;\n    var parentWidth = $this.parentNode.getBoundingClientRect().width;\n\n    var offsetLeft = $this.offsetLeft;\n    var parentOffsetLeft = $this.parentNode.offsetLeft;\n    var canvasLeft = parentOffsetLeft - offsetLeft;\n    var textIndent = offsetLeft - parentOffsetLeft;\n\n    // canvas.style.left= canvasLeft + 'px';\n    return {\n      lineHeight: lineHeight,\n      width: width,\n      height: height,\n      parentWidth: parentWidth,\n      fontFamily: fontFamily,\n      fontSize: fontSize,\n      fontStyle: fontStyle,\n      baselinePositionRatio: baselinePositionRatio,\n      canvasLeft: canvasLeft,\n      textIndent: textIndent\n    };\n  }\n\n  var requestAnimFrame = function (callback) {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {\n      window.setTimeout(callback, 1000 / 60);\n    };\n  }();\n\n  function Underline(element, options) {\n    this.underlines = [];\n\n    if (!element) {\n      console.error('No element defined!');\n    }\n\n    var underlineStyles = {\n      'text-underline-color': options.color || '#000',\n      'text-underline-position': options.position || 'auto', // could be ratio or todo: px\n      'text-underline-skip': options.skip || true,\n      'text-underline-width': options.width || 'auto' // could be auto or px or ratio\n    };\n\n    // if element parameter is a string, query the dom for it,\n    // otherwise just use it\n    element = typeof element === 'string' ? document.querySelectorAll(element) : element;\n\n    [].forEach.call(element, function (el) {\n      var elementStyles = getElementStyles(el);\n      var underline;\n      // single line or multiple line?\n      if (elementStyles.height > elementStyles.lineHeight) {\n        underline = new MultipleUnderline(el, underlineStyles, elementStyles);\n      } else {\n        // single line\n        underline = new SingleUnderline(el, underlineStyles, elementStyles);\n      }\n      this.underlines.push(underline);\n    }.bind(this));\n\n    if (options.animate) {\n      this.animate();\n    }\n  };\n\n  Underline.prototype.animate = function () {\n    this.underlines.forEach(function (underline) {\n      underline.clear();\n      underline.update();\n      underline.draw();\n    }.bind(this));\n    requestAnimFrame(this.animate.bind(this));\n  };\n\n  return Underline;\n});\n\n},{\"./baseline-ratio\":1,\"./multiple-underline\":4,\"./single-underline\":8}],4:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('multipleUnderline', [], function () {\n      return root.multipleUnderline = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.MultipleUnderline = factory();\n  }\n})(undefined, function () {\n  var multiplyValue = require('./multiply-value');\n  var optimalStrokeWidthPos = require('./optimal-stroke-width-pos');\n  var GuitarString = require('./guitar-string');\n  var Point = require('./point');\n  var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n\n  function MultipleUnderline(element, underlineStyles, elementStyles) {\n    //ctor\n    this.element = element;\n\n    this.text = this.element.textContent;\n\n    this.underlineStyles = underlineStyles;\n\n    // this.elementStyles = getElementStyles(element);\n    this.elementStyles = elementStyles;\n\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext('2d');\n\n    this.ratio = window.devicePixelRatio;\n    this.canvas.width = this.elementStyles.width * this.ratio;\n    this.canvas.height = this.elementStyles.height * this.ratio;\n    // this.canvas.height = this.canvas.clientHeight + this.elementStyles.lineHeight;\n    this.canvas.style.left = this.elementStyles.canvasLeft + 'px';\n    this.element.appendChild(this.canvas);\n    this.canvas.style.width = this.elementStyles.width + 'px';\n\n    this.ctx.font = this.font = this.elementStyles.fontStyle + ' ' + multiplyValue(this.elementStyles.fontSize, this.ratio) + ' ' + this.elementStyles.fontFamily;\n\n    this.multipleRedrawActive = false;\n    if (is_chrome) {\n      // chrome floor the lineheight when it is not a whole number\n      // this.elementStyles.lineHeight = Math.floor(this.elementStyles.lineHeight * this.ratio);\n      this.elementStyles.lineHeight = this.elementStyles.lineHeight * this.ratio;\n    } else {\n      this.elementStyles.lineHeight = this.elementStyles.lineHeight * this.ratio;\n    }\n\n    // determine the text-underline-width / strokeWidth\n    var dotWidth = this.ctx.measureText('.')['width'];\n    if (this.underlineStyles['text-underline-width'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.strokeWidth = dotWidth / 12;\n    } else {\n      //if set to px value, todo: other unit such as em?\n      this.strokeWidth = this.underlineStyles['text-underline-width'];\n      //get number value\n      this.strokeWidth = parseFloat(this.strokeWidth) * this.ratio;\n    }\n\n    // determine the text-underline-position / underlinePosition\n    // text-underline-position in ratio, todo: default and user set position ratio\n    if (this.underlineStyles['text-underline-position'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.underlinePosition = parseFloat(this.elementStyles.fontSize) * this.ratio * (1 - this.elementStyles.baselinePositionRatio + this.elementStyles.baselinePositionRatio * 0.4) + this.strokeWidth / 2;\n    } else {\n      //if set to ratio value, todo: other unit such as em, px?\n      var userUnderlinePosition = parseFloat(this.underlineStyles['text-underline-position']);\n      // console.log(userUnderlinePosition);\n      this.underlinePosition = parseFloat(this.elementStyles.fontSize) * this.ratio * (1 - this.elementStyles.baselinePositionRatio + this.elementStyles.baselinePositionRatio * userUnderlinePosition) + this.strokeWidth / 2;\n    }\n\n    var adjustValue = optimalStrokeWidthPos(this.strokeWidth, this.underlinePosition);\n    this.strokeWidth = adjustValue.strokeWidth;\n    this.underlinePosition = adjustValue.posY;\n\n    this.lines = [];\n    this.myStrings = [];\n\n    var words = this.text.match(/[^\\s-]+-?\\s?/g);\n    var line = '';\n\n    var linePositionY = 0;\n    var firstLineCount = 0;\n    for (var n = 0; n < words.length; n++) {\n      // add the whitespace after getting the width measurement\n      if (words[n].match(/\\s+$/)) {\n        // the last character of words[n] is whitespace\n        var newWord = words[n].replace(/\\s+$/, '');\n        var testLine = line + newWord;\n        var testLineMetrics = this.ctx.measureText(testLine);\n        var testLineWidth = testLineMetrics.width;\n        testLine = testLine + ' ';\n      } else {\n        var testLine = line + words[n];\n        var testLineMetrics = this.ctx.measureText(testLine);\n        var testLineWidth = testLineMetrics.width;\n      }\n\n      if (!firstLineCount) {\n        //the first line, should consider startingPointX\n        if (testLineWidth + this.elementStyles.textIndent * this.ratio > this.elementStyles.parentWidth * this.ratio && n > 0) {\n          //  draw the underline\n          if (line.match(/\\s+$/)) {\n            // the last character of line is whitespace\n            var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n            var lineWidth = lineMetrics.width;\n          } else {\n            var lineMetrics = this.ctx.measureText(line);\n            var lineWidth = lineMetrics.width;\n          }\n\n          var tempLine = {\n            lineText: line,\n            lineTextIndent: this.elementStyles.textIndent * this.ratio - 0.2,\n            linePositionY: linePositionY,\n            lineMeasureWidth: lineWidth\n          };\n          this.lines.push(tempLine);\n\n          line = words[n];\n          linePositionY += this.elementStyles.lineHeight;\n          firstLineCount++;\n        } else {\n          line = testLine;\n        }\n      } else {\n        if (testLineWidth > this.elementStyles.parentWidth * this.ratio && n > 0) {\n          //  draw the underline\n          if (line.match(/\\s+$/)) {\n            // the last character of line is whitespace\n            var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n            var lineWidth = lineMetrics.width;\n          } else {\n            var lineMetrics = this.ctx.measureText(line);\n            var lineWidth = lineMetrics.width;\n          }\n\n          var tempLine = {\n            lineText: line,\n            lineTextIndent: -0.2,\n            linePositionY: linePositionY,\n            lineMeasureWidth: lineWidth\n          };\n          this.lines.push(tempLine);\n\n          line = words[n];\n          linePositionY += this.elementStyles.lineHeight;\n        } else {\n          line = testLine;\n        }\n      }\n    }\n    // draw the last line\n    //  draw the underline\n    if (line.match(/\\s+$/)) {\n      // the last character of line is whitespace\n      var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n      var lineWidth = lineMetrics.width;\n    } else {\n      var lineMetrics = this.ctx.measureText(line);\n      var lineWidth = lineMetrics.width;\n    }\n\n    var tempLine = {\n      lineText: line,\n      lineTextIndent: -0.2,\n      linePositionY: linePositionY,\n      lineMeasureWidth: lineWidth\n    };\n    this.lines.push(tempLine);\n    for (var i = 0; i < this.lines.length; i++) {\n      var tempLine = this.lines[i];\n      var myString = new GuitarString(this.ctx, new Point(tempLine.lineTextIndent, tempLine.linePositionY + this.underlinePosition), new Point(tempLine.lineTextIndent + tempLine.lineMeasureWidth, tempLine.linePositionY + this.underlinePosition), this.strokeWidth, this.underlineStyles['text-underline-color'], this.ratio);\n      this.myStrings.push(myString);\n    }\n\n    this.drawUnderline();\n    this.drawHoles();\n  }\n\n  MultipleUnderline.prototype.drawUnderline = function () {\n    // draw the underline\n    for (var i = 0; i < this.myStrings.length; i++) {\n      var tempString = this.myStrings[i];\n      // tempString.clear();\n      tempString.update();\n      tempString.draw();\n    }\n  };\n\n  MultipleUnderline.prototype.drawHoles = function () {\n    // draw the font stroke\n    for (var i = 0; i < this.lines.length; i++) {\n      var tempLine = this.lines[i];\n\n      this.ctx.globalCompositeOperation = \"destination-out\";\n      this.ctx.font = this.font;\n\n      this.ctx.fillStyle = 'green';\n      this.ctx.textBaseline = 'top';\n      this.ctx.fillText(tempLine.lineText, tempLine.lineTextIndent, tempLine.linePositionY);\n\n      this.ctx.lineWidth = 2 * this.ratio + this.strokeWidth * 3.6;\n      this.ctx.strokeStyle = 'blue';\n      this.ctx.strokeText(tempLine.lineText, tempLine.lineTextIndent, tempLine.linePositionY);\n    }\n  };\n\n  MultipleUnderline.prototype.clear = function () {\n    // clear\n    var lastMultipleRedrawActive = this.multipleRedrawActive;\n    this.multipleRedrawActive = false;\n    for (var i = 0; i < this.myStrings.length; i++) {\n      var tempString = this.myStrings[i];\n      // this.myString.clear();\n      // console.log(tempString.redrawActive);\n      if (tempString.redrawActive) {\n        this.multipleRedrawActive = true;\n      }\n    }\n    // console.log(this.multipleRedrawActive);\n    if (this.multipleRedrawActive) {\n      console.log('clear now!');\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n    // if (!lastMultipleRedrawActive && this.multipleRedrawActive) {\n    //     for(var i = 0; i < this.myStrings.length; i++) {\n    //         var tempString = this.myStrings[i];\n    //         tempString.drawLine();\n    //     }\n    // }\n  };\n\n  MultipleUnderline.prototype.update = function () {\n    //update\n  };\n\n  MultipleUnderline.prototype.draw = function () {\n    // draw\n    if (this.multipleRedrawActive) {\n      this.drawUnderline();\n      this.drawHoles();\n    }\n  };\n\n  return MultipleUnderline;\n});\n\n},{\"./guitar-string\":2,\"./multiply-value\":5,\"./optimal-stroke-width-pos\":6,\"./point\":7}],5:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('multiplyValue', [], function () {\n      return root.multiplyValue = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.MultiplyValue = factory();\n  }\n})(undefined, function () {\n\n  var multiplyValue = function multiplyValue(value, multiplier) {\n    var str = value;\n    var m = multiplier;\n    var result = str.match(/(\\d*\\.?\\d*)(.*)/);\n    //http://stackoverflow.com/questions/2868947/split1px-into-1px-1-px-in-javascript\n    return result[1] * m + result[2];\n  };\n\n  return multiplyValue;\n});\n\n},{}],6:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('optimalStrokeWidthPos', [], function () {\n      return root.optimalStrokeWidthPos = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.OptimalStrokeWidthPos = factory();\n  }\n})(undefined, function () {\n  var optimalStrokeWidthPos = function optimalStrokeWidthPos(strokeWidth, posY) {\n    if (strokeWidth < 1) {\n      posY = Math.round(posY - 0.5) + 0.5;\n    } else if (strokeWidth >= 1) {\n      strokeWidth = Math.round(strokeWidth);\n      if (strokeWidth % 2) {\n        // odd, posY -> 0.5\n        posY = Math.round(posY - 0.5) + 0.5;\n      } else {\n        // even, posY -> 1\n        posY = Math.round(posY);\n      }\n    }\n    return {\n      strokeWidth: strokeWidth,\n      posY: posY\n    };\n  };\n  return optimalStrokeWidthPos;\n});\n\n},{}],7:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('point', [], function () {\n      return root.point = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Point = factory();\n  }\n})(undefined, function () {\n  var Point = function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  };\n\n  return Point;\n});\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('singleUnderline', [], function () {\n      return root.singleUnderline = factory();\n    });\n  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.SingleUnderline = factory();\n  }\n})(undefined, function () {\n  var multiplyValue = require('./multiply-value');\n  var optimalStrokeWidthPos = require('./optimal-stroke-width-pos');\n  var GuitarString = require('./guitar-string');\n  var Point = require('./point');\n\n  function SingleUnderline(element, underlineStyles, elementStyles) {\n    //ctor\n    this.element = element;\n\n    this.text = this.element.textContent;\n\n    this.underlineStyles = underlineStyles;\n\n    this.elementStyles = elementStyles;\n    this.redrawActive = false;\n\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext('2d');\n\n    this.ratio = window.devicePixelRatio;\n    this.canvas.width = this.elementStyles.width * this.ratio;\n    this.canvas.height = this.elementStyles.height * this.ratio;\n    this.element.appendChild(this.canvas);\n    this.canvas.style.width = this.elementStyles.width + 'px';\n\n    this.ctx.font = this.font = this.elementStyles.fontStyle + ' ' + multiplyValue(this.elementStyles.fontSize, this.ratio) + ' ' + this.elementStyles.fontFamily;\n\n    // determine the text-underline-width / strokeWidth\n    var dotWidth = this.ctx.measureText('.')['width'];\n    if (this.underlineStyles['text-underline-width'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.strokeWidth = dotWidth / 12;\n    } else {\n      //if set to px value, todo: other unit such as em?\n      this.strokeWidth = this.underlineStyles['text-underline-width'];\n      //get number value\n      this.strokeWidth = parseFloat(this.strokeWidth) * this.ratio;\n    }\n\n    // determine the text-underline-position / underlinePosition\n    // text-underline-position in ratio, todo: default and user set position ratio\n    if (this.underlineStyles['text-underline-position'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      // console.log(this.elementStyles.baselinePositionRatio);\n      this.underlinePosition = parseFloat(this.elementStyles.height) * this.ratio * (1 - this.elementStyles.baselinePositionRatio + this.elementStyles.baselinePositionRatio * 0.4) + this.strokeWidth / 2;\n    } else {\n      //if set to ratio value, todo: other unit such as em, px?\n      var userUnderlinePosition = parseFloat(this.underlineStyles['text-underline-position']);\n      // console.log(this.elementStyles.baselinePositionRatio);\n      this.underlinePosition = parseFloat(this.elementStyles.height) * this.ratio * (1 - this.elementStyles.baselinePositionRatio + this.elementStyles.baselinePositionRatio * userUnderlinePosition) + this.strokeWidth / 2;\n    }\n\n    var adjustValue = optimalStrokeWidthPos(this.strokeWidth, this.underlinePosition);\n    this.strokeWidth = adjustValue.strokeWidth;\n    this.underlinePosition = adjustValue.posY;\n\n    // todo: if last character is a space, remove the space\n    var textWidth = this.ctx.measureText(this.text).width;\n\n    this.myString = new GuitarString(this.ctx, new Point(0, this.underlinePosition), new Point(textWidth, this.underlinePosition), this.strokeWidth, this.underlineStyles['text-underline-color'], this.ratio);\n    this.drawHoles();\n  }\n\n  SingleUnderline.prototype.drawUnderline = function () {\n    //  draw the underline\n    this.myString.draw();\n  };\n\n  SingleUnderline.prototype.drawHoles = function () {\n    // draw the font stroke\n    this.ctx.font = this.font;\n    this.ctx.textBaseline = 'top';\n\n    this.ctx.globalCompositeOperation = \"destination-out\";\n\n    this.ctx.lineWidth = 2 * this.ratio + this.strokeWidth * 3.6;\n    this.ctx.strokeStyle = 'blue';\n    this.ctx.beginPath();\n    this.ctx.strokeText(this.text, -0.2, 0);\n\n    this.ctx.fillStyle = 'green';\n    this.ctx.beginPath();\n    this.ctx.fillText(this.text, -0.2, 0);\n  };\n\n  SingleUnderline.prototype.clear = function () {\n    this.redrawActive = this.myString.redrawActive;\n    // clear\n    if (this.myString.redrawActive) {\n      // this.myString.clear();\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n  };\n\n  SingleUnderline.prototype.update = function () {\n    // update\n    if (this.myString.redrawActive) {\n      this.myString.update();\n    }\n  };\n\n  SingleUnderline.prototype.draw = function () {\n    // draw\n    if (this.redrawActive) {\n      this.drawUnderline();\n      this.drawHoles();\n    }\n  };\n\n  return SingleUnderline;\n});\n\n},{\"./guitar-string\":2,\"./multiply-value\":5,\"./optimal-stroke-width-pos\":6,\"./point\":7}]},{},[3])(3)\n});\n\n","/* Universal Module Definition */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('baselineRatio', [], function () {\n      return (root.baselineRatio = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.baselineRatio = factory();\n  }\n}(this, function () {\n  var baselineRatio = function(elem) {\n    // Get the baseline in the context of whatever element is passed in.\n    elem = elem || document.body;\n\n    // The container is a little defenseive.\n    var container = document.createElement('div');\n    container.style.display = \"block\";\n    container.style.position = \"absolute\";\n    container.style.bottom = \"0\";\n    container.style.right = \"0\";\n    container.style.width = \"0px\";\n    container.style.height = \"0px\";\n    container.style.margin = \"0\";\n    container.style.padding = \"0\";\n    container.style.visibility = \"hidden\";\n    container.style.overflow = \"hidden\";\n\n    // Intentionally unprotected style definition.\n    var small = document.createElement('span');\n    var large = document.createElement('span');\n\n    // Large numbers help improve accuracy.\n    small.style.fontSize = \"0px\";\n    large.style.fontSize = \"2000px\";\n\n    small.innerHTML = \"X\";\n    large.innerHTML = \"X\";\n\n    container.appendChild(small);\n    container.appendChild(large);\n\n    // Put the element in the DOM for a split second.\n    elem.appendChild(container);\n    var smalldims = small.getBoundingClientRect();\n    var largedims = large.getBoundingClientRect();\n    elem.removeChild(container);\n\n    // Calculate where the baseline was, percentage-wise.\n    var baselineposition = smalldims.top - largedims.top;\n    var height = largedims.height;\n\n    return 1 - (baselineposition / height);\n  }\n\n  return baselineRatio;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('guitarString', [], function() {\n      return (root.guitarString = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.GuitarString = factory();\n  }\n}(this, function() {\n  var Point = require('./point');\n  var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n\n  //audio play multiple channels at the same time: http://www.storiesinflight.com/html5/audio.html\n  var channel_max = 10; // number of channels\n  var audiochannels = new Array();\n  for (var a = 0; a < channel_max; a++) { // prepare the channels\n    audiochannels[a] = new Array();\n    audiochannels[a]['channel'] = new Audio(); // create a new audio object\n    audiochannels[a]['finished'] = -1; // expected end time for this channel\n  }\n\n  function play_multi_sound(s) {\n    for (var a = 0; a < audiochannels.length; a++) {\n      var thistime = new Date();\n      if (audiochannels[a]['finished'] < thistime.getTime()) { // is this channel finished?\n        audiochannels[a]['finished'] = thistime.getTime() + document.getElementById(s).duration * 1000;\n        audiochannels[a]['channel'].src = document.getElementById(s).src;\n        audiochannels[a]['channel'].load();\n        audiochannels[a]['channel'].play();\n        break;\n      }\n    }\n  }\n\n\n\n  var circleCenter = function(startPoint, thirdPoint, endPoint) {\n    var dy1 = thirdPoint.y - startPoint.y;\n    var dx1 = thirdPoint.x - startPoint.x;\n    var dy2 = endPoint.y - thirdPoint.y;\n    var dx2 = endPoint.x - thirdPoint.x;\n\n    var aSlope = dy1 / dx1;\n    var bSlope = dy2 / dx2;\n\n\n    var centerX = (aSlope * bSlope * (startPoint.y - endPoint.y) + bSlope * (startPoint.x + thirdPoint.x) - aSlope * (thirdPoint.x + endPoint.x)) / (2 * (bSlope - aSlope));\n    var centerY = -1 * (centerX - (startPoint.x + thirdPoint.x) / 2) / aSlope + (startPoint.y + thirdPoint.y) / 2;\n    var r = dist(centerX, centerY, startPoint.x, startPoint.y)\n\n    return {\n      x: centerX,\n      y: centerY,\n      r: r\n    };\n  }\n\n  var dist = function(x, y, x0, y0) {\n    return Math.sqrt((x -= x0) * x + (y -= y0) * y);\n  };\n\n\n  var intersects = function(a, b, c, d, p, q, r, s) {\n    // returns true if the line from (a,b)->(c,d) intersects with (p,q)->(r,s)\n    var det, gamma, lambda;\n    det = (c - a) * (s - q) - (r - p) * (d - b);\n    if (det === 0) {\n      return false;\n    } else {\n      lambda = ((s - q) * (r - a) + (p - r) * (s - b)) / det;\n      gamma = ((b - d) * (r - a) + (c - a) * (s - b)) / det;\n      return (0 < lambda && lambda < 1) && (0 < gamma && gamma < 1);\n    }\n  };\n\n  var musicLevel = function(startPoint, endPoint, ratio) {\n    var length = dist(startPoint.x, startPoint.y, endPoint.x, endPoint.y) / ratio;\n\n    var level = Math.floor(length / 30);\n    if (level > 19) {\n      level = 19;\n    }\n    level = 19 - level\n    if (level < 10) {\n      level = '0' + level\n    }\n    return level;\n  };\n\n  function GuitarString(ctx, startPoint, endPoint, strokeWidth, strokeColor, ratio) {\n    //ctor\n    this.ctx = ctx;\n    this.canvas = ctx.canvas;\n    this.startPoint = startPoint;\n    this.endPoint = endPoint;\n    this.strokeWidth = strokeWidth;\n    this.strokeColor = strokeColor;\n    this.ratio = ratio;\n\n    this.level = musicLevel(this.startPoint, this.endPoint, this.ratio);\n\n    // this.canvas.width = this.canvas.clientWidth;\n    // this.canvas.height = this.canvas.clientHeight*1.2;\n\n    this.maxGrabDistance = this.strokeWidth * 2;\n    this.maxControlDistance = this.strokeWidth * 6;\n\n    this.ctx.lineWidth = this.strokeWidth;\n    this.ctx.strokeStyle = this.strokeColor;\n    this.ctx.beginPath();\n    this.ctx.moveTo(this.startPoint.x, this.startPoint.y);\n    this.ctx.lineTo(this.endPoint.x, this.endPoint.y);\n    this.ctx.globalCompositeOperation = \"source-over\";\n    this.ctx.stroke();\n\n    this.currentMouseX;\n    this.currentMouseY;\n    this.lastMouseX;\n    this.lastMouseY;\n    this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n    this.waveInitY = this.startPoint.y - this.maxControlDistance;\n    this.waveCount = 0;\n    this.damping = 0.9;\n\n    this.thirdPoint = new Point((this.startPoint.x + this.endPoint.x) / 2, this.startPoint.y);\n\n\n    // state flags\n    this.userInControl = false;\n    this.userPlucked = false;\n    this.waveInControl = false;\n    this.waveFinished = false;\n    this.initState = true;\n    this.lastRedraw = false;\n    this.redrawActive = false;\n\n    //add event listener\n    var self = this;\n    this.canvas.addEventListener('mouseover', function(event) {\n      self.mouseOver(self, event);\n    }, false);\n\n    this.canvas.addEventListener('mousemove', function(event) {\n      self.mouseMove(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"mouseleave\", function(event) {\n      self.mouseLeave(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"mouseout\", function(event) {\n      self.mouseOut(self, event);\n    }, false);\n\n    this.canvas.addEventListener(\"touchstart\", function(event) {\n      self.touchDown(self, event);\n    }, false);\n    this.canvas.addEventListener(\"touchmove\", function(event) {\n      self.touchXY(self, event);\n    }, false);\n    this.canvas.addEventListener(\"touchend\", function(event) {\n      self.touchUp(self, event);\n    }, false);\n\n  }\n\n  GuitarString.prototype.mouseOver = function(self, event) {\n    // console.log('mouseOver');\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseX = event.layerY * this.ratio;\n  };\n  GuitarString.prototype.mouseMove = function(self, event) {\n    // console.log('mouseMove');\n    this.lastMouseX = this.currentMouseX;\n    this.lastMouseY = this.currentMouseY;\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseY = event.layerY * this.ratio;\n\n    var radius = circleCenter(new Point(this.startPoint.x, this.startPoint.y),\n      new Point(this.currentMouseX, this.currentMouseY),\n      new Point(this.endPoint.x, this.endPoint.y)).r;\n    var currentWaveDistance = radius - Math.sqrt(Math.pow(radius, 2) - Math.pow((Math.abs(this.endPoint.x - this.startPoint.x)) / 2, 2));\n    var lastRadius = circleCenter(new Point(this.startPoint.x, this.startPoint.y),\n      new Point(this.lastMouseX, this.lastMouseY),\n      new Point(this.endPoint.x, this.endPoint.y)).r;\n    var lastWaveDistance = lastRadius - Math.sqrt(Math.pow(lastRadius, 2) - Math.pow((Math.abs(this.endPoint.x - this.startPoint.x)) / 2, 2));\n\n\n\n    var mouseInGrabRange = currentWaveDistance < this.maxGrabDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x;\n\n    var lastMouseOutGrabRange = !(lastWaveDistance < this.maxGrabDistance && this.lastMouseX > this.startPoint.x && this.lastMouseX < this.endPoint.x);\n\n    var mouseOutControlRange = !(currentWaveDistance < this.maxControlDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x);\n\n    var lastMouseInControlRange = lastWaveDistance < this.maxControlDistance && this.lastMouseX > this.startPoint.x && this.lastMouseY < this.endPoint.x;\n\n    var mouseCrossed = intersects(this.lastMouseX, this.lastMouseY,\n      this.currentMouseX, this.currentMouseY,\n      this.startPoint.x, this.startPoint.y,\n      this.endPoint.x, this.endPoint.y);\n\n    if (mouseInGrabRange && lastMouseOutGrabRange && (!this.userInControl)) {\n      // console.log('grab!');\n      this.initState = false;\n      this.userInControl = true;\n      this.waveInControl = false;\n      this.waveFinished = false;\n\n      this.redrawActive = true;\n    } else if (mouseOutControlRange && lastMouseInControlRange && this.userInControl) {\n      // console.log('boing!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.waveCount = 0;\n      // this.waveInitX = this.lastMouseX;\n      // this.waveInitY = this.lastMouseY;\n      this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n      this.waveInitY = this.endPoint.y + this.maxControlDistance;\n      // play audio\n      play_multi_sound('audio' + this.level);\n      // createjs.Sound.play('cello_' + this.level);\n\n    }\n\n    if ((!this.userInControl) && mouseCrossed) {\n      // console.log('i just plucked!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n      this.waveInitX = (this.startPoint.x + this.endPoint.y) / 2;\n      this.waveInitY = this.endPoint.y + this.maxGrabDistance * 2 / 3;\n    }\n  };\n  GuitarString.prototype.mouseLeave = function(self, event) {\n    // console.log('mouseLeave');\n    if (this.userInControl) {\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n\n      this.waveInitX = event.layerX * this.ratio;\n      this.waveInitY = event.layerY * this.ratio;\n\n    }\n  };\n  GuitarString.prototype.mouseOut = function(self, event) {\n    // console.log('mouseOut');\n  };\n  GuitarString.prototype.touchDown = function(self, event) {\n    // console.log('touchDown');\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseX = event.layerY * this.ratio;\n  };\n  GuitarString.prototype.touchXY = function(self, event) {\n    // console.log('touchMove');\n    this.lastMouseX = this.currentMouseX;\n    this.lastMouseY = this.currentMouseY;\n    this.currentMouseX = event.layerX * this.ratio;\n    this.currentMouseY = event.layerY * this.ratio;\n\n    var radius = circleCenter(new Point(this.startPoint.x, this.startPoint.y),\n      new Point(this.currentMouseX, this.currentMouseY),\n      new Point(this.endPoint.x, this.endPoint.y)).r;\n    var currentWaveDistance = radius - Math.sqrt(Math.pow(radius, 2) - Math.pow((Math.abs(this.endPoint.x - this.startPoint.x)) / 2, 2));\n    var lastRadius = circleCenter(new Point(this.startPoint.x, this.startPoint.y),\n      new Point(this.lastMouseX, this.lastMouseY),\n      new Point(this.endPoint.x, this.endPoint.y)).r;\n    var lastWaveDistance = lastRadius - Math.sqrt(Math.pow(lastRadius, 2) - Math.pow((Math.abs(this.endPoint.x - this.startPoint.x)) / 2, 2));\n\n\n\n    var mouseInGrabRange = currentWaveDistance < this.maxGrabDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x;\n\n    var lastMouseOutGrabRange = !(lastWaveDistance < this.maxGrabDistance && this.lastMouseX > this.startPoint.x && this.lastMouseX < this.endPoint.x);\n\n    var mouseOutControlRange = !(currentWaveDistance < this.maxControlDistance && this.currentMouseX > this.startPoint.x && this.currentMouseX < this.endPoint.x);\n\n    var lastMouseInControlRange = lastWaveDistance < this.maxControlDistance && this.lastMouseX > this.startPoint.x && this.lastMouseY < this.endPoint.x;\n\n    var mouseCrossed = intersects(this.lastMouseX, this.lastMouseY,\n      this.currentMouseX, this.currentMouseY,\n      this.startPoint.x, this.startPoint.y,\n      this.endPoint.x, this.endPoint.y);\n\n    if (mouseInGrabRange && lastMouseOutGrabRange && (!this.userInControl)) {\n      // console.log('grab!');\n      this.initState = false;\n      this.userInControl = true;\n      this.waveInControl = false;\n      this.waveFinished = false;\n\n      this.redrawActive = true;\n    } else if (mouseOutControlRange && lastMouseInControlRange && this.userInControl) {\n      // console.log('boing!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.waveCount = 0;\n      // this.waveInitX = this.lastMouseX;\n      // this.waveInitY = this.lastMouseY;\n      this.waveInitX = (this.startPoint.x + this.endPoint.x) / 2;\n      this.waveInitY = this.endPoint.y + this.maxControlDistance;\n      // play audio\n      play_multi_sound('audio' + this.level);\n\n    }\n\n    if ((!this.userInControl) && mouseCrossed) {\n      // console.log('i just plucked!');\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n      this.waveInitX = (this.startPoint.x + this.endPoint.y) / 2;\n      this.waveInitY = this.endPoint.y + this.maxGrabDistance * 2 / 3;\n      // play audio\n      // play_multi_sound('audio' + this.level);\n\n    }\n  };\n  GuitarString.prototype.touchUp = function(self, event) {\n    // console.log('touchUp');\n    if (this.userInControl) {\n      this.initState = false;\n      this.userInControl = false;\n      this.waveInControl = true;\n      this.waveFinished = false;\n      this.redrawActive = true;\n      this.waveCount = 0;\n\n      this.waveInitX = event.layerX * this.ratio;\n      this.waveInitY = event.layerY * this.ratio;\n\n    }\n  };\n\n\n  GuitarString.prototype.clear = function() {\n    // clear\n    // if(this.redrawActive){\n    // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    // }\n  };\n\n  GuitarString.prototype.update = function() {\n    // console.log(this.redrawActive);\n    // if(this.redrawActive){\n    if (this.userInControl) {\n      this.thirdPoint = new Point(this.currentMouseX, this.currentMouseY);\n    }\n    if (this.waveInControl) {\n      var waveX = this.waveInitX;\n      var waveY = this.startPoint.y +\n        (this.waveInitY - this.startPoint.y) * Math.cos(this.waveCount / 5 * Math.PI) * Math.pow(this.damping, this.waveCount);\n\n      if (Math.pow(this.damping, this.waveCount) > 0.03) {\n        // still waving ....\n        this.thirdPoint = new Point(waveX, waveY);\n        this.waveCount++;\n      } else {\n        // wave damped to a straight line, wave is finished\n        this.waveInControl = false;\n        this.waveFinished = true;\n        this.lastRedraw = true;\n        this.thirdPoint = new Point(waveX, waveY);\n      }\n    }\n    // }\n  }\n\n  GuitarString.prototype.draw = function() {\n    // if(this.redrawActive){\n    // draw stuff\n    // }\n    if (this.lastRedraw) {\n      this.drawLine();\n      this.lastRedraw = false;\n      this.redrawActive = false;\n    } else {\n      this.drawArc(this.startPoint, this.thirdPoint, this.endPoint);\n    }\n  };\n  GuitarString.prototype.drawLine = function() {\n    // draw a line instead of a flat curve when it stops redraw, pixel-perfect\n    this.ctx.lineWidth = this.strokeWidth;\n    this.ctx.strokeStyle = this.strokeColor;\n    this.ctx.beginPath();\n    this.ctx.moveTo(this.startPoint.x, this.startPoint.y);\n    this.ctx.lineTo(this.endPoint.x, this.endPoint.y);\n    this.ctx.globalCompositeOperation = \"source-over\";\n    this.ctx.stroke();\n  };\n\n\n  GuitarString.prototype.drawArc = function(startPoint, thirdPoint, endPoint) {\n    var ctx = this.ctx;\n    ctx.lineWidth = this.strokeWidth;\n    ctx.strokeStyle = this.strokeColor;\n\n    var centerObject = circleCenter(new Point(startPoint.x, startPoint.y),\n      new Point(thirdPoint.x, thirdPoint.y),\n      new Point(endPoint.x, endPoint.y));\n    var centerX = centerObject.x;\n    var centerY = centerObject.y;\n    var r = centerObject.r\n\n    var angle = Math.atan2(centerX - startPoint.x, centerY - startPoint.y);\n    // console.log(centerObject);\n    if (!angle) {\n      ctx.beginPath();\n      ctx.moveTo(startPoint.x, startPoint.y);\n      ctx.lineTo(endPoint.x, endPoint.y);\n    } else {\n      if (angle > Math.PI / 2) {\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, r, Math.PI * 1.5 - angle, Math.PI * 1.5 + angle, true);\n      } else {\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, r, Math.PI * 1.5 - angle, Math.PI * 1.5 + angle, false);\n      }\n    }\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.stroke();\n\n  }\n  return GuitarString;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('underline', [], function() {\n      return (root.underline = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Underline = factory();\n  }\n}(this, function() {\n  var baselineRatio = require('./baseline-ratio');\n  var MultipleUnderline = require('./multiple-underline');\n  var SingleUnderline = require('./single-underline');\n\n\n  function getElementStyles(element) {\n    // lineHeight, height, ratio, fontFamily, fontSize, fontStyle\n    var $this = element;\n\n    var baselinePositionRatio = baselineRatio(element);\n    var lineHeight = parseFloat(window.getComputedStyle($this, null)\n      .getPropertyValue(\"line-height\"));\n    var fontFamily = window.getComputedStyle($this, null)\n      .getPropertyValue(\"font-family\");\n    var fontSize = window.getComputedStyle($this, null)\n      .getPropertyValue(\"font-size\");\n    var fontStyle = window.getComputedStyle($this, null)\n      .getPropertyValue(\"font-style\");\n    var width = $this.getBoundingClientRect().width;\n    var height = $this.getBoundingClientRect().height;\n    var parentWidth = $this.parentNode.getBoundingClientRect().width;\n\n\n    var offsetLeft = $this.offsetLeft;\n    var parentOffsetLeft = $this.parentNode.offsetLeft;\n    var canvasLeft = parentOffsetLeft - offsetLeft;\n    var textIndent = offsetLeft - parentOffsetLeft;\n\n    // canvas.style.left= canvasLeft + 'px';\n    return {\n      lineHeight: lineHeight,\n      width: width,\n      height: height,\n      parentWidth: parentWidth,\n      fontFamily: fontFamily,\n      fontSize: fontSize,\n      fontStyle: fontStyle,\n      baselinePositionRatio: baselinePositionRatio,\n      canvasLeft: canvasLeft,\n      textIndent: textIndent\n    }\n  }\n\n  var requestAnimFrame = (function(callback) {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||\n      function(callback) {\n        window.setTimeout(callback, 1000 / 60);\n      };\n  })();\n\n  function Underline(element, options) {\n    this.underlines = [];\n\n    if (!element) {\n      console.error('No element defined!');\n    }\n\n    var underlineStyles = {\n      'text-underline-color': options.color || '#000',\n      'text-underline-position': options.position || 'auto', // could be ratio or todo: px\n      'text-underline-skip': options.skip || true,\n      'text-underline-width': options.width || 'auto' // could be auto or px or ratio\n    }\n\n    // if element parameter is a string, query the dom for it,\n    // otherwise just use it\n    element = typeof element === 'string' ? document.querySelectorAll(element) : element;\n\n    [].forEach.call(element, function(el) {\n      var elementStyles = getElementStyles(el);\n      var underline;\n      // single line or multiple line?\n      if (elementStyles.height > elementStyles.lineHeight) {\n        underline = new MultipleUnderline(el, underlineStyles, elementStyles);\n      } else {\n        // single line\n        underline = new SingleUnderline(el, underlineStyles, elementStyles);\n      }\n      this.underlines.push(underline);\n    }.bind(this));\n\n    if (options.animate) {\n      this.animate();\n    }\n  };\n\n  Underline.prototype.animate = function() {\n    this.underlines.forEach(function(underline) {\n      underline.clear();\n      underline.update();\n      underline.draw();\n    }.bind(this))\n    requestAnimFrame(this.animate.bind(this));\n  };\n\n  return Underline;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('multipleUnderline', [], function() {\n      return (root.multipleUnderline = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.MultipleUnderline = factory();\n  }\n}(this, function() {\n  var multiplyValue = require('./multiply-value');\n  var optimalStrokeWidthPos = require('./optimal-stroke-width-pos');\n  var GuitarString = require('./guitar-string');\n  var Point = require('./point');\n  var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n\n  function MultipleUnderline(element, underlineStyles, elementStyles) {\n    //ctor\n    this.element = element;\n\n    this.text = this.element.textContent;\n\n    this.underlineStyles = underlineStyles;\n\n    // this.elementStyles = getElementStyles(element);\n    this.elementStyles = elementStyles;\n\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext('2d');\n\n\n    this.ratio = window.devicePixelRatio;\n    this.canvas.width = this.elementStyles.width * this.ratio;\n    this.canvas.height = this.elementStyles.height * this.ratio;\n    // this.canvas.height = this.canvas.clientHeight + this.elementStyles.lineHeight;\n    this.canvas.style.left = this.elementStyles.canvasLeft + 'px';\n    this.element.appendChild(this.canvas);\n    this.canvas.style.width = this.elementStyles.width + 'px';\n\n    this.ctx.font = this.font = this.elementStyles.fontStyle + ' ' + multiplyValue(this.elementStyles.fontSize, this.ratio) + ' ' + this.elementStyles.fontFamily;\n\n    this.multipleRedrawActive = false;\n    if (is_chrome) {\n      // chrome floor the lineheight when it is not a whole number\n      // this.elementStyles.lineHeight = Math.floor(this.elementStyles.lineHeight * this.ratio);\n      this.elementStyles.lineHeight = this.elementStyles.lineHeight * this.ratio;\n    } else {\n      this.elementStyles.lineHeight = this.elementStyles.lineHeight * this.ratio;\n    }\n\n    // determine the text-underline-width / strokeWidth\n    var dotWidth = this.ctx.measureText('.')['width'];\n    if (this.underlineStyles['text-underline-width'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.strokeWidth = dotWidth / 12;\n    } else {\n      //if set to px value, todo: other unit such as em?\n      this.strokeWidth = this.underlineStyles['text-underline-width'];\n      //get number value\n      this.strokeWidth = parseFloat(this.strokeWidth) * this.ratio;\n    }\n\n    // determine the text-underline-position / underlinePosition\n    // text-underline-position in ratio, todo: default and user set position ratio\n    if (this.underlineStyles['text-underline-position'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.underlinePosition = parseFloat(this.elementStyles.fontSize) * this.ratio * (1 - this.elementStyles.baselinePositionRatio +\n        this.elementStyles.baselinePositionRatio * 0.4) + this.strokeWidth / 2;\n    } else {\n      //if set to ratio value, todo: other unit such as em, px?\n      var userUnderlinePosition = parseFloat(this.underlineStyles['text-underline-position']);\n      // console.log(userUnderlinePosition);\n      this.underlinePosition = parseFloat(this.elementStyles.fontSize) * this.ratio *\n        (1 - this.elementStyles.baselinePositionRatio +\n          this.elementStyles.baselinePositionRatio * userUnderlinePosition) + this.strokeWidth / 2;\n    }\n\n\n    var adjustValue = optimalStrokeWidthPos(this.strokeWidth, this.underlinePosition);\n    this.strokeWidth = adjustValue.strokeWidth;\n    this.underlinePosition = adjustValue.posY;\n\n    this.lines = [];\n    this.myStrings = [];\n\n    var words = this.text.match(/[^\\s-]+-?\\s?/g);\n    var line = '';\n\n    var linePositionY = 0;\n    var firstLineCount = 0;\n    for (var n = 0; n < words.length; n++) {\n      // add the whitespace after getting the width measurement\n      if (words[n].match(/\\s+$/)) {\n        // the last character of words[n] is whitespace\n        var newWord = words[n].replace(/\\s+$/, '');\n        var testLine = line + newWord;\n        var testLineMetrics = this.ctx.measureText(testLine);\n        var testLineWidth = testLineMetrics.width;\n        testLine = testLine + ' ';\n      } else {\n        var testLine = line + words[n];\n        var testLineMetrics = this.ctx.measureText(testLine);\n        var testLineWidth = testLineMetrics.width;\n      }\n\n      if (!firstLineCount) {\n        //the first line, should consider startingPointX\n        if (testLineWidth + this.elementStyles.textIndent * this.ratio > this.elementStyles.parentWidth * this.ratio && n > 0) {\n          //  draw the underline\n          if (line.match(/\\s+$/)) {\n            // the last character of line is whitespace\n            var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n            var lineWidth = lineMetrics.width;\n          } else {\n            var lineMetrics = this.ctx.measureText(line);\n            var lineWidth = lineMetrics.width;\n          }\n\n          var tempLine = {\n            lineText: line,\n            lineTextIndent: this.elementStyles.textIndent * this.ratio - 0.2,\n            linePositionY: linePositionY,\n            lineMeasureWidth: lineWidth\n          }\n          this.lines.push(tempLine)\n\n          line = words[n];\n          linePositionY += this.elementStyles.lineHeight;\n          firstLineCount++;\n        } else {\n          line = testLine;\n        }\n      } else {\n        if (testLineWidth > this.elementStyles.parentWidth * this.ratio && n > 0) {\n          //  draw the underline\n          if (line.match(/\\s+$/)) {\n            // the last character of line is whitespace\n            var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n            var lineWidth = lineMetrics.width;\n          } else {\n            var lineMetrics = this.ctx.measureText(line);\n            var lineWidth = lineMetrics.width;\n          }\n\n          var tempLine = {\n            lineText: line,\n            lineTextIndent: -0.2,\n            linePositionY: linePositionY,\n            lineMeasureWidth: lineWidth\n          }\n          this.lines.push(tempLine);\n\n          line = words[n];\n          linePositionY += this.elementStyles.lineHeight;\n        } else {\n          line = testLine;\n        }\n      }\n    }\n    // draw the last line\n    //  draw the underline\n    if (line.match(/\\s+$/)) {\n      // the last character of line is whitespace\n      var lineMetrics = this.ctx.measureText(line.replace(/\\s+$/, ''));\n      var lineWidth = lineMetrics.width;\n    } else {\n      var lineMetrics = this.ctx.measureText(line);\n      var lineWidth = lineMetrics.width;\n    }\n\n    var tempLine = {\n      lineText: line,\n      lineTextIndent: -0.2,\n      linePositionY: linePositionY,\n      lineMeasureWidth: lineWidth\n    }\n    this.lines.push(tempLine);\n    for (var i = 0; i < this.lines.length; i++) {\n      var tempLine = this.lines[i];\n      var myString = new GuitarString(\n        this.ctx,\n        new Point(tempLine.lineTextIndent, tempLine.linePositionY + this.underlinePosition),\n        new Point(tempLine.lineTextIndent + tempLine.lineMeasureWidth, tempLine.linePositionY + this.underlinePosition),\n        this.strokeWidth, this.underlineStyles['text-underline-color'], this.ratio);\n      this.myStrings.push(myString);\n    }\n\n    this.drawUnderline();\n    this.drawHoles();\n\n  }\n\n  MultipleUnderline.prototype.drawUnderline = function() {\n    // draw the underline\n    for (var i = 0; i < this.myStrings.length; i++) {\n      var tempString = this.myStrings[i];\n      // tempString.clear();\n      tempString.update();\n      tempString.draw();\n    }\n\n  };\n\n\n  MultipleUnderline.prototype.drawHoles = function() {\n    // draw the font stroke\n    for (var i = 0; i < this.lines.length; i++) {\n      var tempLine = this.lines[i];\n\n      this.ctx.globalCompositeOperation = \"destination-out\";\n      this.ctx.font = this.font;\n\n      this.ctx.fillStyle = 'green';\n      this.ctx.textBaseline = 'top';\n      this.ctx.fillText(tempLine.lineText, tempLine.lineTextIndent, tempLine.linePositionY);\n\n      this.ctx.lineWidth = 2 * this.ratio + this.strokeWidth * 3.6;\n      this.ctx.strokeStyle = 'blue';\n      this.ctx.strokeText(tempLine.lineText, tempLine.lineTextIndent, tempLine.linePositionY);\n\n    }\n  }\n\n  MultipleUnderline.prototype.clear = function() {\n    // clear\n    var lastMultipleRedrawActive = this.multipleRedrawActive;\n    this.multipleRedrawActive = false;\n    for (var i = 0; i < this.myStrings.length; i++) {\n      var tempString = this.myStrings[i];\n      // this.myString.clear();\n      // console.log(tempString.redrawActive);\n      if (tempString.redrawActive) {\n        this.multipleRedrawActive = true;\n      }\n    }\n    // console.log(this.multipleRedrawActive);\n    if (this.multipleRedrawActive) {\n      console.log('clear now!')\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n    // if (!lastMultipleRedrawActive && this.multipleRedrawActive) {\n    //     for(var i = 0; i < this.myStrings.length; i++) {\n    //         var tempString = this.myStrings[i];\n    //         tempString.drawLine();\n    //     }\n    // }\n\n  };\n\n  MultipleUnderline.prototype.update = function() {\n    //update\n  };\n\n\n  MultipleUnderline.prototype.draw = function() {\n    // draw\n    if (this.multipleRedrawActive) {\n      this.drawUnderline();\n      this.drawHoles();\n    }\n  };\n\n  return MultipleUnderline;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('multiplyValue', [], function() {\n      return (root.multiplyValue = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.MultiplyValue = factory();\n  }\n}(this, function() {\n\n  var multiplyValue = function(value, multiplier) {\n    var str = value;\n    var m = multiplier;\n    var result = str.match(/(\\d*\\.?\\d*)(.*)/);\n    //http://stackoverflow.com/questions/2868947/split1px-into-1px-1-px-in-javascript\n    return result[1] * m + result[2];\n  }\n\n  return multiplyValue;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('optimalStrokeWidthPos', [], function() {\n      return (root.optimalStrokeWidthPos = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.OptimalStrokeWidthPos = factory();\n  }\n}(this, function() {\n  var optimalStrokeWidthPos = function(strokeWidth, posY) {\n    if (strokeWidth < 1) {\n      posY = Math.round(posY - 0.5) + 0.5;\n    } else if (strokeWidth >= 1) {\n      strokeWidth = Math.round(strokeWidth);\n      if (strokeWidth % 2) {\n        // odd, posY -> 0.5\n        posY = Math.round(posY - 0.5) + 0.5;\n      } else {\n        // even, posY -> 1\n        posY = Math.round(posY);\n      }\n    }\n    return {\n      strokeWidth: strokeWidth,\n      posY: posY\n    }\n  }\n  return optimalStrokeWidthPos;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('point', [], function() {\n      return (root.point = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Point = factory();\n  }\n}(this, function() {\n  var Point = function(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  return Point;\n}));\n","/* Universal Module Definition */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as a named AMD module.\n    define('singleUnderline', [], function() {\n      return (root.singleUnderline = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.SingleUnderline = factory();\n  }\n}(this, function() {\n  var multiplyValue = require('./multiply-value');\n  var optimalStrokeWidthPos = require('./optimal-stroke-width-pos');\n  var GuitarString = require('./guitar-string');\n  var Point = require('./point');\n\n  function SingleUnderline(element, underlineStyles, elementStyles) {\n    //ctor\n    this.element = element;\n\n    this.text = this.element.textContent;\n\n    this.underlineStyles = underlineStyles;\n\n    this.elementStyles = elementStyles;\n    this.redrawActive = false;\n\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext('2d');\n\n    this.ratio = window.devicePixelRatio;\n    this.canvas.width = this.elementStyles.width * this.ratio;\n    this.canvas.height = this.elementStyles.height * this.ratio;\n    this.element.appendChild(this.canvas);\n    this.canvas.style.width = this.elementStyles.width + 'px';\n\n    this.ctx.font = this.font = this.elementStyles.fontStyle + ' ' + multiplyValue(this.elementStyles.fontSize, this.ratio) + ' ' + this.elementStyles.fontFamily;\n\n    // determine the text-underline-width / strokeWidth\n    var dotWidth = this.ctx.measureText('.')['width'];\n    if (this.underlineStyles['text-underline-width'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      this.strokeWidth = dotWidth / 12;\n    } else {\n      //if set to px value, todo: other unit such as em?\n      this.strokeWidth = this.underlineStyles['text-underline-width'];\n      //get number value\n      this.strokeWidth = parseFloat(this.strokeWidth) * this.ratio;\n    }\n\n\n    // determine the text-underline-position / underlinePosition\n    // text-underline-position in ratio, todo: default and user set position ratio\n    if (this.underlineStyles['text-underline-position'] == \"auto\") {\n      // if set to auto, calculate the optimized width based on font\n      // console.log(this.elementStyles.baselinePositionRatio);\n      this.underlinePosition = parseFloat(this.elementStyles.height) * this.ratio * (1 - this.elementStyles.baselinePositionRatio +\n        this.elementStyles.baselinePositionRatio * 0.4) + this.strokeWidth / 2;\n    } else {\n      //if set to ratio value, todo: other unit such as em, px?\n      var userUnderlinePosition = parseFloat(this.underlineStyles['text-underline-position']);\n      // console.log(this.elementStyles.baselinePositionRatio);\n      this.underlinePosition = parseFloat(this.elementStyles.height) * this.ratio *\n        (1 - this.elementStyles.baselinePositionRatio +\n          this.elementStyles.baselinePositionRatio * userUnderlinePosition) + this.strokeWidth / 2;\n    }\n\n    var adjustValue = optimalStrokeWidthPos(this.strokeWidth, this.underlinePosition);\n    this.strokeWidth = adjustValue.strokeWidth;\n    this.underlinePosition = adjustValue.posY;\n\n    // todo: if last character is a space, remove the space\n    var textWidth = this.ctx.measureText(this.text).width;\n\n    this.myString = new GuitarString(this.ctx,\n      new Point(0, this.underlinePosition),\n      new Point(textWidth, this.underlinePosition),\n      this.strokeWidth, this.underlineStyles['text-underline-color'], this.ratio);\n    this.drawHoles();\n\n  }\n\n  SingleUnderline.prototype.drawUnderline = function() {\n    //  draw the underline\n    this.myString.draw();\n  }\n\n  SingleUnderline.prototype.drawHoles = function() {\n    // draw the font stroke\n    this.ctx.font = this.font;\n    this.ctx.textBaseline = 'top';\n\n    this.ctx.globalCompositeOperation = \"destination-out\";\n\n    this.ctx.lineWidth = 2 * this.ratio + this.strokeWidth * 3.6;\n    this.ctx.strokeStyle = 'blue';\n    this.ctx.beginPath();\n    this.ctx.strokeText(this.text, -0.2, 0);\n\n    this.ctx.fillStyle = 'green';\n    this.ctx.beginPath();\n    this.ctx.fillText(this.text, -0.2, 0);\n  }\n\n  SingleUnderline.prototype.clear = function() {\n    this.redrawActive = this.myString.redrawActive;\n    // clear\n    if (this.myString.redrawActive) {\n      // this.myString.clear();\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n  };\n\n\n  SingleUnderline.prototype.update = function() {\n    // update\n    if (this.myString.redrawActive) {\n      this.myString.update();\n    }\n  };\n\n\n  SingleUnderline.prototype.draw = function() {\n    // draw\n    if (this.redrawActive) {\n      this.drawUnderline();\n      this.drawHoles();\n    }\n  };\n\n  return SingleUnderline;\n}));\n"],"sourceRoot":"/source/"}